!function(){"use strict";const e={saudiPhoneRegex:/^(\+966|966|00966|0)?5[0-9]{8}$/,init:function(){const e=document.querySelector('form[action="/driver-form-handler"]');e&&window.location.pathname.includes("registerdriver")&&(this.setupDriverFormValidation(e),this.setupRealTimePhoneValidation(e),this.setupPhoneFormatting(e))},setupDriverFormValidation:function(e){e.addEventListener("submit",async t=>{t.preventDefault();const n=e.querySelector('input[name="phone"]'),r=e.querySelector('input[name="name"]'),s=e.querySelector('input[name="email"]'),i=e.querySelector('textarea[name="message"]');this.clearAllErrors(e);let a=!0;this.validateName(r)||(a=!1),this.validateSaudiPhone(n)||(a=!1),this.validateEmail(s)||(a=!1),this.validateMessage(i)||(a=!1),a&&await this.submitDriverForm(e)})},setupRealTimePhoneValidation:function(e){const t=e.querySelector('input[name="phone"]');t&&(t.addEventListener("blur",()=>{this.validateSaudiPhone(t)}),t.addEventListener("input",()=>{this.clearFieldError(t)}))},setupPhoneFormatting:function(e){const t=e.querySelector('input[name="phone"]');t&&t.addEventListener("input",e=>{let t=e.target.value.replace(/[^\d+]/g,"");t&&!t.startsWith("+")&&(t.startsWith("966")?t="+"+t:t.startsWith("0")?t="+966"+t.substring(1):t.startsWith("5")&&(t="+966"+t)),e.target.value=t})},validateName:function(e){const t=e.value.trim();return t?t.length<3?(this.showFieldError(e,this.getTranslation("form_messages.name_min_length")||"يجب أن يكون الاسم 3 أحرف على الأقل"),!1):!(t.length>100)||(this.showFieldError(e,this.getTranslation("form_messages.name_max_length")||"الاسم طويل جداً (100 حرف كحد أقصى)"),!1):(this.showFieldError(e,this.getTranslation("form_messages.required_field")||"هذا الحقل مطلوب"),!1)},validateSaudiPhone:function(e){const t=e.value.trim();if(!t)return this.showFieldError(e,this.getTranslation("form_messages.phone_required")||"رقم الهاتف مطلوب"),!1;const n=this.normalizeSaudiPhone(t);return this.saudiPhoneRegex.test(n)?(e.value=this.formatSaudiPhone(n),!0):(this.showFieldError(e,this.getTranslation("form_messages.invalid_phone")||"يرجى إدخال رقم هاتف سعودي صحيح (مثال: +966555134448)"),!1)},validateEmail:function(e){const t=e.value.trim();return t?!!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)||(this.showFieldError(e,this.getTranslation("form_messages.invalid_email")||"يرجى إدخال بريد إلكتروني صحيح"),!1):(this.showFieldError(e,this.getTranslation("form_messages.required_field")||"هذا الحقل مطلوب"),!1)},validateMessage:function(e){const t=e.value.trim();return t?t.length<10?(this.showFieldError(e,this.getTranslation("form_messages.message_min_length")||"يجب أن تكون الرسالة 10 أحرف على الأقل"),!1):!(t.length>5e3)||(this.showFieldError(e,this.getTranslation("form_messages.message_max_length")||"الرسالة طويلة جداً (5000 حرف كحد أقصى)"),!1):(this.showFieldError(e,this.getTranslation("form_messages.required_field")||"هذا الحقل مطلوب"),!1)},normalizeSaudiPhone:function(e){let t=e.replace(/[\s\-\(\)]/g,"");return t.startsWith("+966")?t=t.substring(4):t.startsWith("966")?t=t.substring(3):t.startsWith("00966")?t=t.substring(5):t.startsWith("0")&&(t=t.substring(1)),t},formatSaudiPhone:function(e){return"+966"+this.normalizeSaudiPhone(e)},showFieldError:function(e,t){this.clearFieldError(e);const n=document.createElement("div");n.className="field-error-message",n.textContent=t,n.style.cssText="\n                color: #dc3545;\n                font-size: 13px;\n                margin-top: 8px;\n                margin-right: 36px;\n                animation: fadeInError 0.3s ease;\n                direction: rtl;\n                text-align: right;\n            ",e.parentNode.appendChild(n),e.style.borderColor="#dc3545",e.classList.add("is-invalid-field")},clearFieldError:function(e){const t=e.parentNode.querySelector(".field-error-message");t&&t.remove(),e.style.borderColor="",e.classList.remove("is-invalid-field")},clearAllErrors:function(e){e.querySelectorAll(".field-error-message").forEach(e=>e.remove());e.querySelectorAll("input, textarea").forEach(e=>{e.style.borderColor="",e.classList.remove("is-invalid-field")})},async submitDriverForm(e){const t=e.querySelector('button[type="submit"]'),n=t.innerHTML;t.disabled=!0,t.innerHTML='\n                <span class="button__flair"></span>\n                <span class="text-white tw-text-2xl">\n                    <i class="ph-bold ph-circle-notch" style="animation: spin 1s linear infinite;"></i>\n                </span>\n                <span class="button__label">جاري الإرسال...</span>\n            ';const r=new FormData(e),s={};r.forEach((e,t)=>{s[t]=e.trim()}),s.phone&&(s.phone=this.formatSaudiPhone(s.phone));try{const t=await fetch("/.netlify/functions/register-driver",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),n=await t.json();t.ok&&n.success?(this.showSuccessMessage(e,n.message||this.getTranslation("form_messages.driver_success")||"تم إرسال طلب الانضمام بنجاح! سنتواصل معك قريباً."),e.reset()):this.showErrorMessage(e,n.error||"حدث خطأ أثناء إرسال الطلب. يرجى المحاولة مرة أخرى.")}catch(t){this.showErrorMessage(e,"خطأ في الاتصال. يرجى التحقق من اتصالك بالإنترنت والمحاولة مرة أخرى.")}finally{t.disabled=!1,t.innerHTML=n}},showSuccessMessage:function(e,t){this.removeAlerts(e);const n=document.createElement("div");n.className="alert alert-success driver-form-alert",n.innerHTML=`\n                <i class="ph-bold ph-check-circle" style="margin-left: 8px;"></i>\n                ${t}\n            `,n.style.cssText="\n                margin-top: 20px;\n                padding: 16px 20px;\n                border-radius: 8px;\n                background-color: #d4edda;\n                border: 1px solid #c3e6cb;\n                color: #155724;\n                animation: slideDown 0.5s ease;\n                direction: rtl;\n                text-align: right;\n                display: flex;\n                align-items: center;\n                font-size: 15px;\n            ",e.appendChild(n),setTimeout(()=>{n.style.opacity="0",n.style.transition="opacity 0.5s ease",setTimeout(()=>n.remove(),500)},7e3)},showErrorMessage:function(e,t){this.removeAlerts(e);const n=document.createElement("div");n.className="alert alert-danger driver-form-alert",n.innerHTML=`\n                <i class="ph-bold ph-x-circle" style="margin-left: 8px;"></i>\n                ${t}\n            `,n.style.cssText="\n                margin-top: 20px;\n                padding: 16px 20px;\n                border-radius: 8px;\n                background-color: #f8d7da;\n                border: 1px solid #f5c6cb;\n                color: #721c24;\n                animation: slideDown 0.5s ease;\n                direction: rtl;\n                text-align: right;\n                display: flex;\n                align-items: center;\n                font-size: 15px;\n            ",e.appendChild(n),setTimeout(()=>{n.style.opacity="0",n.style.transition="opacity 0.5s ease",setTimeout(()=>n.remove(),500)},8e3)},removeAlerts:function(e){e.querySelectorAll(".driver-form-alert").forEach(e=>e.remove())},getTranslation:function(e){return window.getTranslation?window.getTranslation(e):null}},t=document.createElement("style");t.textContent="\n        @keyframes fadeInError {\n            from {\n                opacity: 0;\n                transform: translateY(-10px);\n            }\n            to {\n                opacity: 1;\n                transform: translateY(0);\n            }\n        }\n\n        @keyframes slideDown {\n            from {\n                opacity: 0;\n                transform: translateY(-20px);\n            }\n            to {\n                opacity: 1;\n                transform: translateY(0);\n            }\n        }\n\n        @keyframes spin {\n            from { transform: rotate(0deg); }\n            to { transform: rotate(360deg); }\n        }\n\n        .is-invalid-field {\n            border-color: #dc3545 !important;\n        }\n\n        .is-invalid-field:focus {\n            border-color: #dc3545 !important;\n            box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25);\n        }\n\n        .field-error-message {\n            animation: fadeInError 0.3s ease;\n        }\n    ",document.head.appendChild(t),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){e.init()}):e.init(),window.DriverFormHandler=e}();